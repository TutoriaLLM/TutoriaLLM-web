---
title: サーバーにデプロイする
description: A reference page in my new Starlight docs site.
sidebar:
  order: 1
---

import {
  LinkCard,
  Card,
  CardGrid,
  Aside,
  Icon,
} from "@astrojs/starlight/components";

VSCode などを利用してコードを編集することができます。

また、サーバーは Docker を利用してホストすることができます。以下のコマンドで開発サーバーを起動します：

```
docker compose up --build
```

HMR(Hot Module Replacement)を使用したい場合は、以下のコマンドで起動します。ファイルを変更すると自動的にリロードされます。

```
docker compose watch
```

また、以下の環境変数をプロジェクトのルートフォルダ内に作成した`.env`に記載してください：

- AUTH_SECRET - 認証設定で使用するシークレット
- OPENAI_API_KEY - GPT を使用するためのキー

- DB_USER - データベースのユーザー名
- DB_PASSWORD - データベースのパスワード
- DB_HOST - データベースのホスト名。docker-compose ファイルを変更していない場合は`db`を指定してください。
- DB_NAME - データベースの名前

- PORT - アプリが使用するポート番号
- SSL - SSL の設定（true/false）

- DEFAULT_USER_NAME - デフォルトのユーザー名。
- DEFAULT_USER_PASSWORD - デフォルトのユーザーパスワード。

## アプリを使ってみる

### 開発サーバーの起動

<Aside type="note" title="ノート">
  コマンドの詳細は[docker-compose.yml](docker-compose.yml)を参照してください。
</Aside>

VSCode などを利用してコードを編集することができます。

また、サーバーは Docker を利用してホストすることができます。以下のコマンドで開発サーバーを起動します：

```
docker compose up --build
```

HMR(Hot Module Replacement)を使用したい場合は、以下のコマンドで起動します。ファイルを変更すると自動的にリロードされます。

```
docker compose watch
```

また、以下の環境変数をプロジェクトのルートフォルダ内に作成した`.env`に記載してください：

- AUTH_SECRET - 認証設定で使用するシークレット
- OPENAI_API_KEY - GPT を使用するためのキー

- DB_USER - データベースのユーザー名
- DB_PASSWORD - データベースのパスワード
- DB_HOST - データベースのホスト名。docker-compose ファイルを変更していない場合は`db`を指定してください。
- DB_NAME - データベースの名前

- PORT - アプリが使用するポート番号
- SSL - SSL の設定（true/false）

- DEFAULT_USER_NAME - デフォルトのユーザー名。
- DEFAULT_USER_PASSWORD - デフォルトのユーザーパスワード。

### サーバーでアプリを稼働させる（実稼働）

<Aside type="note" title="ノート">
  コマンドの詳細は[GitHub
  リポジトリ](https://github.com/tutoriallm/tutoriallm)の docker-compose
  ファイルを参照してください。
</Aside>
自前のサーバーで稼働させる場合は以下のコマンドで実稼働アプリをビルドし、起動させます。アプリを稼働させるには以下の環境変数が必要です：

- AUTH_SECRET - 認証設定で使用するシークレット
- OPENAI_API_KEY - GPT を使用するための API キー

- DB_USER - データベースのユーザー名
- DB_PASSWORD - データベースのパスワード
- DB_HOST - データベースのホスト名。docker-compose ファイルを変更していない場合は`db`を指定してください。
- DB_NAME - データベースの名前。デフォルトは"code_tutorial_db"です。
- PORT - アプリが使用するポート番号。80 や 8080 など、使用可能なポート番号を指定してください。
- SSL - SSL の設定（true/false）。実稼働環境では SSL を有効にすることをお勧めします。

- DEFAULT_USER_NAME - デフォルトのユーザー名。
- DEFAULT_USER_PASSWORD - デフォルトのユーザーパスワード。

```
docker compose -f docker-compose.prod.yml up
```

### Docker Hub から取得する

[Docker
Hub](https://hub.docker.com/r/soumame/code-tutorial-app)からイメージを取得することも可能です。PostgreSQL,
Redis と接続する必要があります。

<Aside type="caution" title="注意！">
  注意：SSL が必須のプラットフォームにデプロイすると、Minecraft-Core
  拡張機能が正常に動作しない可能性があります。Minecrtaft
  の`/connect`コマンド自体が SSL
  に対応していないため、現時点においてこの問題を解決するためには、SSL
  を無効にするか、Minecraft-Core 拡張機能を無効にする必要があります。
</Aside>

### 認証情報と初期チュートリアルのリセット

<Aside type="note" title="ノート">
  これらのコマンドは初めて Docker compose
  コマンドを実行した際に自動的に実行されます。`app`イメージ内の`.initialized`ファイルの存在を確認して、初期化が必要かどうかを判断しています。
</Aside>

必要がある場合は、コンテナ内の`app`イメージを起動させた状態で、以下のコマンドを実行してください。

```
npm run reset-credential
```

初期チュートリアル（拡張機能から提供されるチュートリアル）も以下の方法でリセットできます。このチュートリアルも自動で実行されているので、不要な場合は管理者画面から削除してください。

```
npm run reset-tutorial
```

### アプリの設定をする

管理者画面にアクセスすることで、アプリの設定を変更することができます。設定は以下の項目があります：

- ダッシュボード
- チュートリアルの管理
- セッションの一覧
- ユーザーの一覧
- サーバー設定

#### アクセス方法

- アプリを稼働させた状態で、`/admin`へアクセスします。
- 初期ユーザー名とパスワードは`.env`ファイルに記載されているものを使用してください。
